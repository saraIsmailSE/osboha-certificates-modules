{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/someO/Desktop/vue/osboha-template/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/someO/Desktop/vue/osboha-template/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.parse-int.js\";\nimport useVuelidate from \"@vuelidate/core\";\nimport { required, helpers, requiredIf, minLength, maxLength } from \"@vuelidate/validators\";\nimport thesisServices from \"../../api/thesisServices\";\nexport default {\n  name: \"CreateThesis\",\n  created: function created() {\n    this.getPhotosCount();\n  },\n  setup: function setup() {\n    return {\n      v$: useVuelidate()\n    };\n  },\n  props: {\n    book: {\n      type: [Object],\n      required: true\n    },\n    user_book_id: {\n      type: [Number],\n      required: true\n    },\n    noOfthesis: {\n      type: [Number],\n      required: true\n    }\n  },\n  data: function data() {\n    return {\n      photos_count: 0,\n      thesis: {\n        text: \"\",\n        pageStart: \"\",\n        pageEnd: \"\",\n        image_1: [],\n        pages: 0\n      },\n      pageError: \"\",\n      imageFlage: false\n    };\n  },\n  validations: function validations() {\n    return {\n      thesis: {\n        text: {\n          required: required,\n          minLength: minLength(500),\n          maxLength: maxLength(1800)\n        },\n        pageStart: {\n          required: required\n        },\n        pageEnd: {\n          required: required,\n          valdiatePages: this.validatePages\n        },\n        image_1: {\n          required: requiredIf(function (nestedModel) {\n            return this.thesis.image_1.length == 0 || this.photos_count < 3; // New changes\n          })\n        }\n      }\n    };\n  },\n  methods: {\n    validatePages: function validatePages() {\n      var error = parseInt(this.thesis.pageStart) < parseInt(this.thesis.pageEnd);\n      if (!error) this.pageError = 'يجب ان تكون صفحة البداية اقل من صفحة النهاية';else this.pageError = '';\n      return error;\n    },\n    submit: function submit() {\n      var _this = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var thesis;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this.v$.$touch();\n\n                console.log(_this.photos_count);\n\n                if (_this.v$.thesis.$invalid) {\n                  _context.next = 14;\n                  break;\n                }\n\n                _context.next = 5;\n                return thesisServices.createThesis(_this.thesis, _this.user_book_id);\n\n              case 5:\n                thesis = _context.sent;\n                console.log(_this.user_book_id);\n                _this.thesis.text = \"\";\n                _this.thesis.pageEnd = \"\";\n                _this.thesis.pageStart = \"\";\n                _this.thesis.image_1 = [];\n                _this.$refs.file.value = null;\n\n                _this.v$.thesis.$reset();\n\n                _this.$emit(\"addThesis\", thesis.data.data);\n\n              case 14:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }))();\n    },\n    uploadFile: function uploadFile() {\n      this.thesis.file = this.$refs.file.files;\n    },\n    getPhotosCount: function getPhotosCount() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var count;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                console.log('-------');\n                _context2.next = 3;\n                return thesisServices.getPhotosCount(_this2.user_book_id);\n\n              case 3:\n                count = _context2.sent;\n                _this2.photos_count = count;\n\n              case 5:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["useVuelidate","required","helpers","requiredIf","minLength","maxLength","thesisServices","name","created","getPhotosCount","setup","v$","props","book","type","Object","user_book_id","Number","noOfthesis","data","photos_count","thesis","text","pageStart","pageEnd","image_1","pages","pageError","imageFlage","validations","valdiatePages","validatePages","nestedModel","length","methods","error","parseInt","submit","$touch","console","log","$invalid","createThesis","$refs","file","value","$reset","$emit","uploadFile","files","count"],"sourceRoot":"","sources":["C:\\Users\\someO\\Desktop\\vue\\osboha-template\\src\\components\\Thesis\\CreateThesis.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <iq-card\r\n      id=\"post-modal-data\"\r\n      body-class=\"iq-card iq-card-block iq-card-stretch iq-card-height\"\r\n    >\r\n      <template v-slot:headerTitle>\r\n        <h4 class=\"card-title\">إضافة الأطروحة {{ noOfthesis + 1 }}</h4>\r\n      </template>\r\n      <template v-slot:body>\r\n        <div class=\"d-flex align-items-center\">\r\n          <form\r\n            @submit.prevent=\"submit\"\r\n            class=\"post-text ml-3 w-100 row\"\r\n            v-if=\"book\"\r\n          >\r\n            <div class=\"form-group col-6\">\r\n              <select\r\n                class=\"form-select\"\r\n                data-trigger\r\n                name=\"choices-single-default\"\r\n                id=\"choices-single-default\"\r\n                v-model=\"v$.thesis.pageStart.$model\"\r\n              >\r\n                <option value=\"\">اختر صفحة البداية</option>\r\n                <option\r\n                  v-for=\"(i, index) in book.pages\"\r\n                  :key=\"index\"\r\n                  :value=\"i\"\r\n                >\r\n                  {{ i }}\r\n                </option>\r\n              </select>\r\n              <small style=\"color: red\" v-if=\"v$.thesis.pageStart.$error\"\r\n                >الرجاء قم بادخال صفحة البداية</small\r\n              >\r\n            </div>\r\n            <div class=\"form-group col-6\">\r\n              <select\r\n                class=\"form-select\"\r\n                data-trigger\r\n                name=\"choices-single-default\"\r\n                id=\"choices-single-default\"\r\n                v-model=\"v$.thesis.pageEnd.$model\"\r\n              >\r\n                <option value=\"\">اختر صفحة النهاية</option>\r\n                <option\r\n                  v-for=\"(i, index) in book.pages\"\r\n                  :key=\"index\"\r\n                  :value=\"i\"\r\n                >\r\n                  {{ i }}\r\n                </option>\r\n              </select>\r\n              <small style=\"color: red\" v-if=\"v$.thesis.pageEnd.$error\">{{\r\n                pageError ? pageError : \" الرجاء قم بادخال صفحة النهاية\"\r\n              }}</small>\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label class=\"form-label\" for=\"thesisBody\">الأطروحة</label>\r\n              <textarea\r\n                rows=\"5\"\r\n                placeholder=\"... اكتب أطروحتك\"\r\n                class=\"rounded form-control\"\r\n                id=\"thesisBody\"\r\n                v-model=\"v$.thesis.text.$model\"\r\n              ></textarea>\r\n              <p style=\"color: red\" v-if=\"v$.thesis.text.$error\">\r\n                لطفًا قم بكتابة اطروحة عدد حروفها بين 500  و 1800             \r\n              </p>\r\n            </div>\r\n\r\n            <div class=\"form-group\">\r\n              <label class=\"form-label\" for=\"customFile\"\r\n                >صورة من مجموعة السفراء</label\r\n              >\r\n              <input\r\n                class=\"form-control\"\r\n                type=\"file\"\r\n                id=\"customFile\"\r\n                ref=\"file\"\r\n                @input=\"thesis.image_1 = $event.target.files[0]\"\r\n              />\r\n              <small style=\"color: red\" v-if=\"v$.thesis.image_1.$error\"\r\n                >الرجاء قم برفع صورة\r\n              </small>\r\n            </div>\r\n            <input\r\n              type=\"submit\"\r\n              value=\"إضافة\"\r\n              href=\"javascript:void(0);\"\r\n              class=\"btn btn-primary d-block mt-3\"\r\n            />\r\n          </form>\r\n        </div>\r\n        <hr />\r\n      </template>\r\n    </iq-card>\r\n  </div>\r\n</template>\r\n<script>\r\nimport useVuelidate from \"@vuelidate/core\";\r\nimport { required, helpers, requiredIf,minLength, maxLength } from \"@vuelidate/validators\";\r\nimport thesisServices from \"../../api/thesisServices\";\r\n\r\nexport default {\r\n  name: \"CreateThesis\",\r\n  created() {\r\n     \r\n    this.getPhotosCount()\r\n  },\r\n  setup() {\r\n    return { v$: useVuelidate() };\r\n  },\r\n  props: {\r\n    book: {\r\n      type: [Object],\r\n      required: true,\r\n    },\r\n    user_book_id: {\r\n      type: [Number],\r\n      required: true,\r\n    },\r\n    noOfthesis: {\r\n      type: [Number],\r\n      required: true,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      photos_count:0,\r\n      thesis: {\r\n        text: \"\",\r\n        pageStart: \"\",\r\n        pageEnd: \"\",\r\n        image_1: [],\r\n        pages: 0,\r\n      },\r\n      pageError: \"\",\r\n      imageFlage: false,\r\n    };\r\n  },\r\n  validations() {\r\n    return {\r\n      thesis: {\r\n        text: {\r\n          required,\r\n          minLength: minLength(500),\r\n          maxLength: maxLength(1800)\r\n\r\n        },\r\n        pageStart: {\r\n          required,\r\n        },\r\n        pageEnd: {\r\n          required,\r\n          valdiatePages: this.validatePages,\r\n        },\r\n        image_1: {\r\n          required: requiredIf(function (nestedModel) {\r\n        \r\n            return this.thesis.image_1.length == 0 || this.photos_count < 3; // New changes\r\n          }),\r\n        },\r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n \r\n    validatePages(){\r\n      const error =  parseInt(this.thesis.pageStart) < parseInt(this.thesis.pageEnd)\r\n      if(!error)this.pageError = 'يجب ان تكون صفحة البداية اقل من صفحة النهاية'\r\n      else this.pageError = ''\r\n \r\n      return error;\r\n    },\r\n    async submit() {\r\n      this.v$.$touch();\r\n      console.log(this.photos_count)\r\n      if (!this.v$.thesis.$invalid) {\r\n        const thesis = await thesisServices.createThesis(\r\n          this.thesis,\r\n          this.user_book_id\r\n        );\r\n        console.log(this.user_book_id)\r\n        this.thesis.text = \"\";\r\n        this.thesis.pageEnd = \"\";\r\n        this.thesis.pageStart = \"\";\r\n        this.thesis.image_1 = [];\r\n      \r\n        this.$refs.file.value = null;\r\n        this.v$.thesis.$reset();\r\n        this.$emit(\"addThesis\", thesis.data.data);\r\n      }\r\n    },\r\n    uploadFile() {\r\n      this.thesis.file = this.$refs.file.files;\r\n    },\r\n    async getPhotosCount(){\r\n      console.log('-------') \r\n      const count = await thesisServices.getPhotosCount(this.user_book_id);\r\n      this.photos_count = count ;\r\n    }\r\n  },\r\n};\r\n</script>\r\n"]},"metadata":{},"sourceType":"module"}