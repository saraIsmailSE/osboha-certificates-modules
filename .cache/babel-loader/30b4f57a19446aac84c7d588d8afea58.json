{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/someO/Desktop/vue/osboha-template/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/someO/Desktop/vue/osboha-template/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.parse-int.js\";\nimport thesisServices from \"../../api/thesisServices\";\nimport useVuelidate from \"@vuelidate/core\";\nimport { required, integer, requiredIf } from \"@vuelidate/validators\";\nimport IqCard from '../../components/custom/cards/iq-card.vue';\nexport default {\n  name: \"UpdateQuestion\",\n  created: function created() {\n    var _this = this;\n\n    return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return thesisServices.getById(_this.$route.params.id);\n\n            case 2:\n              _this.thesisToupdate = _context.sent;\n              _this.user_book_id = _this.thesisToupdate.user_book.id;\n              _this.book = _this.thesisToupdate.user_book.book;\n              _this.thesis.text = _this.thesisToupdate.thesis_text;\n              _this.thesis.ending_page = _this.thesisToupdate.ending_page;\n              _this.thesis.starting_page = _this.thesisToupdate.starting_page;\n              _this.thesis.photos = _this.thesisToupdate.photos;\n              _context.next = 11;\n              return _this.getPhotosCount();\n\n            case 11:\n              console.log(_this.photosCount);\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }))();\n  },\n  components: {\n    IqCard: IqCard\n  },\n  setup: function setup() {\n    return {\n      v$: useVuelidate()\n    };\n  },\n  data: function data() {\n    return {\n      user_book_id: 0,\n      loader: false,\n      photosCount: 0,\n      thesis: {\n        text: \"\",\n        starting_page: \"\",\n        ending_page: \"\"\n      },\n      book: [],\n      upload: [],\n      files: [[], [], []],\n      message: \"\",\n      thesisToupdate: [],\n      errors: [false, false, false],\n      pageError: ''\n    };\n  },\n  validations: function validations() {\n    return {\n      thesis: {\n        text: {\n          required: required\n        },\n        starting_page: {\n          required: required,\n          valdiatePages: this.validatePages\n        },\n        ending_page: {\n          required: required,\n          valdiatePages: this.validatePages\n        }\n      }\n    };\n  },\n  methods: {\n    uploadNewThesisImage: function uploadNewThesisImage() {\n      var _this2 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return thesisServices.uploadPhoto(_this2.files[2], _this2.thesisToupdate.id);\n\n              case 2:\n                window.location.reload();\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }))();\n    },\n    getPhotosCount: function getPhotosCount() {\n      var _this3 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var count;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return thesisServices.getPhotosCount(_this3.user_book_id);\n\n              case 2:\n                count = _context3.sent;\n                _this3.photosCount = count;\n\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      }))();\n    },\n    deletePhoto: function deletePhoto(image) {\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return thesisServices.deletePhoto(image.id);\n\n              case 2:\n                window.location.reload();\n\n              case 3:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4);\n      }))();\n    },\n    validatePages: function validatePages() {\n      var error = parseInt(this.thesis.starting_page) < parseInt(this.thesis.ending_page);\n      if (!error) this.pageError = 'يجب ان تكون صفحة البداية اقل من صفحة النهاية';else this.pageError = '';\n      return error;\n    },\n    submit: function submit() {\n      var _this4 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var thesis;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _this4.v$.$touch();\n\n                if (_this4.v$.thesis.$invalid) {\n                  _context5.next = 9;\n                  break;\n                }\n\n                _this4.message = \"\";\n                _this4.loader = true;\n                _context5.next = 6;\n                return thesisServices.updateThesis(_this4.thesis, _this4.$route.params.id);\n\n              case 6:\n                thesis = _context5.sent;\n                _this4.loader = false;\n                _this4.message = \"تم التعديل بنجاح\";\n\n              case 9:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5);\n      }))();\n    },\n    back: function back() {\n      this.$router.push({\n        name: 'achievement.theses',\n        params: {\n          id: this.thesisToupdate.user_book.book.id\n        }\n      });\n    },\n    resolve_img_url: function resolve_img_url(image) {\n      var url = \"http://127.0.0.1:8000/api/thesises/image?path=\".concat(image.path);\n      return url;\n    },\n    updatePhoto: function updatePhoto(image, index) {\n      var _this5 = this;\n\n      return _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var res;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                if (!(_this5.files[index].length === 0)) {\n                  _context6.next = 4;\n                  break;\n                }\n\n                _this5.errors[index] = true;\n                _context6.next = 8;\n                break;\n\n              case 4:\n                _context6.next = 6;\n                return thesisServices.updatePicture(_this5.files[index], image.path);\n\n              case 6:\n                res = _context6.sent;\n                _this5.thesis.photos[index] = res;\n\n              case 8:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6);\n      }))();\n    },\n    uploadImage: function uploadImage(index, file) {\n      this.files[index] = file;\n      this.errors[index] = false;\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["thesisServices","useVuelidate","required","integer","requiredIf","IqCard","name","created","getById","$route","params","id","thesisToupdate","user_book_id","user_book","book","thesis","text","thesis_text","ending_page","starting_page","photos","getPhotosCount","console","log","photosCount","components","setup","v$","data","loader","upload","files","message","errors","pageError","validations","valdiatePages","validatePages","methods","uploadNewThesisImage","uploadPhoto","window","location","reload","count","deletePhoto","image","error","parseInt","submit","$touch","$invalid","updateThesis","back","$router","push","resolve_img_url","url","path","updatePhoto","index","length","updatePicture","res","uploadImage","file"],"sourceRoot":"","sources":["C:\\Users\\someO\\Desktop\\vue\\osboha-template\\src\\views\\Theses\\update.vue"],"sourcesContent":["<template>\r\n  <div class=\"col-sm-12 mt-3\">\r\n    <iq-card class=\"iq-card\">\r\n      <div class=\"iq-card-header-toolbar d-flex align-items-center mx-auto\">\r\n        <h3 class=\"text-center mt-3 mb-3\">تعديل الاطروحة</h3>\r\n      </div>\r\n      <div class=\"iq-card-body p-3\">\r\n        <div class=\"image-block text-center\">\r\n          <img\r\n            src=\"@/assets/images/update-forms.png\"\r\n            class=\"img-fluid rounded w-50\"\r\n            alt=\"blog-img\"\r\n          />\r\n        </div>\r\n\r\n        <div\r\n          class=\"d-flex align-items-center mt-3\"\r\n          v-if=\"\r\n            thesisToupdate.status == null || thesisToupdate.status == 'rejected'\r\n          \"\r\n        >\r\n          <form @submit.prevent=\"submit\" class=\"post-text ml-3 w-100 row\">\r\n            <div class=\"form-group col-6\">\r\n              <select\r\n                class=\"form-select\"\r\n                data-trigger\r\n                name=\"choices-single-default\"\r\n                id=\"choices-single-default\"\r\n                v-model=\"v$.thesis.starting_page.$model\"\r\n              >\r\n                <option value=\"\">اختر صفحة البداية</option>\r\n                <option\r\n                  v-for=\"(i, index) in book.pages\"\r\n                  :key=\"index\"\r\n                  :value=\"i\"\r\n                >\r\n                  {{ i }}\r\n                </option>\r\n              </select>\r\n             <small style=\"color: red\" v-if=\"v$.thesis.starting_page.$error\"\r\n                >{{pageError ? pageError :' الرجاء قم بادخال صفحة البداية'}}</small\r\n              >\r\n            </div>\r\n            <div class=\"form-group col-6\">\r\n              <select\r\n                class=\"form-select\"\r\n                data-trigger\r\n                name=\"choices-single-default\"\r\n                id=\"choices-single-default\"\r\n                v-model=\"v$.thesis.ending_page.$model\"\r\n              >\r\n                <option value=\"\">اختر صفحة النهاية</option>\r\n                <option\r\n                  v-for=\"(i, index) in book.pages\"\r\n                  :key=\"index\"\r\n                  :value=\"i\"\r\n                >\r\n                  {{ i }}\r\n                </option>\r\n              </select>\r\n                <small style=\"color: red\" v-if=\"v$.thesis.ending_page.$error\"\r\n                >{{pageError ? pageError :' الرجاء قم بادخال صفحة النهاية'}}</small\r\n              >\r\n            </div>\r\n            <div class=\"form-group\">\r\n              <label class=\"form-label\" for=\"thesisBody\">الأطروحة</label>\r\n              <textarea\r\n                rows=\"5\"\r\n                placeholder=\"... اكتب أطروحتك\"\r\n                class=\"rounded form-control\"\r\n                id=\"thesisBody\"\r\n                v-model=\"v$.thesis.text.$model\"\r\n              ></textarea>\r\n              <p style=\"color: red\" v-if=\"v$.thesis.text.$error\">\r\n                الرجاء قم بكتابة الأطروحة\r\n              </p>\r\n            </div>\r\n\r\n \r\n\r\n            <div class=\"col-sm-12 text-center\" v-if=\"loader\">\r\n              <img\r\n                src=\"../../assets/images/page-img/page-load-loader.gif\"\r\n                alt=\"loader\"\r\n                style=\"height: 100px\"\r\n              />\r\n            </div>\r\n            <h4 class=\"text-center mt-3 mb-3\" v-if=\"message\">{{ message }}</h4>\r\n            <div class=\"d-inline-block w-100 text-center\">\r\n              <button\r\n                type=\"\"\r\n                @click=\"back()\"\r\n                class=\"btn d-block btn-primary mt-3 mb-3 w-75 mx-auto\"\r\n                v-if=\"message\"\r\n              >\r\n                عودة لصفحة الأنجاز\r\n              </button>\r\n              <input type=\"submit\" value=\"تعديل\" href=\"javascript:void(0);\" class=\"btn btn-primary d-block mt-3 w-100\"\r\n                v-else />\r\n          </div>\r\n            \r\n          </form>\r\n          \r\n        </div>\r\n        \r\n        <div class=\"d-flex align-items-center mt-3 row\" v-else>\r\n          <h4 class=\"text-center mt-3 mb-3 col-12\">\r\n            لا يمكنك تعديل السؤال لأنه في حالة التقييم أو تم تقييمه\r\n          </h4>\r\n          <div class=\"d-inline-block w-100 text-center col-12\">\r\n            <button\r\n              type=\"\"\r\n              @click=\"back()\"\r\n              class=\"btn d-block btn-primary mt-3 mb-3 w-75 mx-auto\"\r\n            >\r\n              عودة لصفحة الأنجاز\r\n            </button>\r\n            \r\n          </div>\r\n          \r\n        </div>\r\n      </div>\r\n      \r\n    </iq-card>\r\n    \r\n  </div>\r\n\r\n <div class=\"col-sm-12 mt-3\">\r\n    <iq-card class=\"iq-card\">\r\n       <div class=\"iq-card-header-toolbar d-flex align-items-center mx-auto\">\r\n        <h3 class=\"text-center mt-3 mb-3\">تعديل صور الاطروحة</h3>\r\n      </div>\r\n         <div class=\"iq-card-body p-3\">\r\n      <div class=\"user-post\" v-if=\"thesis.photos\">\r\n              <div class=\"d-grid grid-rows-2 grid-flow-col gap-3\">\r\n                <div\r\n                  class=\"row-span-2 row-span-md-1\"\r\n                  v-for=\"(image,index) in thesis.photos\"\r\n                  :key=\"image.id\"\r\n                >\r\n                  <img\r\n                    :src=\"resolve_img_url(image)\"\r\n                    alt=\"post-image\"\r\n                    class=\"img-fluid rounded w-100\"\r\n                  />\r\n                  <hr>\r\n                    <input\r\n                class=\"form-control\"\r\n                type=\"file\"\r\n                id=\"customFile2\"\r\n                ref=\"file\"\r\n                @input=\"uploadImage(index,$event.target.files[0])\"\r\n                 \r\n              />\r\n              <small v-if=\"errors[index]\" style=\"color:red\"><p>الرجاء اختيار صورة اولا</p></small>\r\n               <button\r\n                type=\"\"\r\n                @click=\"updatePhoto(image,index)\"\r\n                class=\"btn d-block btn-primary mt-3 mb-3 w-75 mx-auto\"\r\n             \r\n              >\r\n              \r\n                    تعديل\r\n              </button> \r\n                 <button\r\n                type=\"\"\r\n                @click=\"deletePhoto(image)\"\r\n                class=\"btn d-block btn-danger mt-3 mb-3 w-75 mx-auto\"\r\n                v-if=\"photosCount > 3\"\r\n              >\r\n              \r\n                    حذف\r\n              </button> \r\n                </div>\r\n               <div\r\n                  class=\"row-span-2 row-span-md-1\"\r\n                  v-if=\"thesis.photos.length == 0\" >\r\n                  <img\r\n                  src=\"@/assets/images/stage2.png\"\r\n                    alt=\"post-image\"\r\n                    class=\"img-fluid rounded w-100\"\r\n                  />\r\n                  <hr>\r\n                    <input\r\n                class=\"form-control\"\r\n                type=\"file\"\r\n                id=\"customFile2\"\r\n                ref=\"file\"\r\n                   @input=\"uploadImage(2,$event.target.files[0])\"\r\n               \r\n  \r\n              />   <small v-if=\"errors[2]\" style=\"color:red\"><p>الرجاء اختيار صورة اولا</p></small>\r\n               <button\r\n                type=\"\"\r\n               \r\n                class=\"btn d-block btn-primary mt-3 mb-3 w-75 mx-auto\"\r\n              @click=\"uploadNewThesisImage()\"\r\n              >\r\n              \r\n                    رفع صورة \r\n              </button> \r\n                  \r\n               </div>\r\n              </div>\r\n            </div>\r\n         </div>\r\n             </iq-card>\r\n             </div>\r\n</template>\r\n<script>\r\nimport thesisServices from \"../../api/thesisServices\";\r\nimport useVuelidate from \"@vuelidate/core\";\r\nimport { required, integer, requiredIf } from \"@vuelidate/validators\";\r\nimport IqCard from '../../components/custom/cards/iq-card.vue';\r\nexport default {\r\n  name: \"UpdateQuestion\",\r\n  async created() {\r\n    this.thesisToupdate = await thesisServices.getById(this.$route.params.id);\r\n     this.user_book_id = this.thesisToupdate.user_book.id\r\n    this.book = this.thesisToupdate.user_book.book;\r\n    this.thesis.text = this.thesisToupdate.thesis_text;\r\n    this.thesis.ending_page = this.thesisToupdate.ending_page;\r\n    this.thesis.starting_page = this.thesisToupdate.starting_page;\r\n    this.thesis.photos = this.thesisToupdate.photos;\r\n    await this.getPhotosCount();\r\n    console.log(this.photosCount)\r\n  },\r\n  components: {IqCard},\r\n  setup() {\r\n    return { v$: useVuelidate() };\r\n  },\r\n  data() {\r\n    return {\r\n      user_book_id:0,\r\n      loader: false,\r\n      photosCount:0,\r\n      thesis: { \r\n        text: \"\",\r\n        starting_page: \"\",\r\n        ending_page: \"\",\r\n       \r\n      },\r\n      book: [],\r\n      upload:[],\r\n      files:[[],[],[]],\r\n      message: \"\",\r\n      thesisToupdate: [],\r\n      errors:[false,false,false]\r\n      ,pageError:''\r\n    };\r\n  },\r\n  validations() {\r\n    return {\r\n      thesis: {\r\n        text: {\r\n          required,\r\n        },\r\n        starting_page: {\r\n          required,valdiatePages:this.validatePages\r\n        },\r\n        ending_page: {\r\n          required,valdiatePages:this.validatePages\r\n        },\r\n       \r\n      },\r\n    };\r\n  },\r\n  methods: {\r\n\r\n    async uploadNewThesisImage(){\r\n        await thesisServices.uploadPhoto(this.files[2],this.thesisToupdate.id);\r\n        window.location.reload()\r\n    },\r\n    \r\n    async getPhotosCount(){\r\n      const  count = await thesisServices.getPhotosCount(this.user_book_id)\r\n      this.photosCount = count;\r\n   \r\n    },\r\n      async deletePhoto(image){\r\n         await thesisServices.deletePhoto(image.id);\r\n         window.location.reload();\r\n    },\r\n      validatePages(){\r\n      const error =  parseInt(this.thesis.starting_page) < parseInt(this.thesis.ending_page)\r\n      \r\n      if(!error)this.pageError = 'يجب ان تكون صفحة البداية اقل من صفحة النهاية'\r\n      else this.pageError = ''\r\n      return error;\r\n    },\r\n    async submit() {\r\n      this.v$.$touch();\r\n      if (!this.v$.thesis.$invalid) {\r\n        this.message = \"\";\r\n        this.loader = true;\r\n        const thesis = await thesisServices.updateThesis(\r\n          this.thesis,\r\n          this.$route.params.id\r\n        );\r\n      \r\n        this.loader = false;\r\n        this.message = \"تم التعديل بنجاح\";\r\n      }\r\n    },\r\n    back() {\r\n      this.$router.push({ name: 'achievement.theses' , params: { id: this.thesisToupdate.user_book.book.id } })\r\n    },\r\n    resolve_img_url: function (image) {\r\n      const url = `http://127.0.0.1:8000/api/thesises/image?path=${image.path}`;\r\n      return url;\r\n    },\r\n   async updatePhoto(image,index){\r\n    \r\n      if(this.files[index].length === 0){\r\n        this.errors[index] = true\r\n      }else{\r\n     \r\n      const res =  await thesisServices.updatePicture(this.files[index],image.path);\r\n      this.thesis.photos[index] = res;\r\n      }\r\n    },\r\n     \r\n    uploadImage(index,file){\r\n      this.files[index] = file;\r\n      this.errors[index] = false;\r\n    }\r\n  },\r\n\r\n\r\n  \r\n};\r\n</script>\r\n"]},"metadata":{},"sourceType":"module"}